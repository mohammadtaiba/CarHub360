<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContractManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">mmra</a> &gt; <a href="index.source.html" class="el_package">de.fherfurt.core.contract</a> &gt; <span class="el_source">ContractManager.java</span></div><h1>ContractManager.java</h1><pre class="source lang-java linenums">package de.fherfurt.core.contract;

import de.fherfurt.core.customer.Customer;
import de.fherfurt.logic.rentVehicle.RentVehicle;
import de.fherfurt.logic.saleVehicle.SaleVehicle;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.temporal.ChronoUnit;
import java.util.ArrayList;
import java.util.List;

/**
 * This class manages the creation, termination, and renewal of contracts.
 */
<span class="nc" id="L16">public class ContractManager {</span>
<span class="nc" id="L17">    private static List&lt;Contract&gt; contracts = new ArrayList&lt;&gt;();</span>

    /**
     * Creates a purchase contract.
     *
     * @param contractId  The unique ID of the contract.
     * @param customer    The customer associated with the contract.
     * @param saleVehicle The vehicle involved in the sale contract.
     * @return True if the purchase contract is successfully created, false otherwise.
     */
    public static boolean createPurchaseContract(int contractId, Customer customer, SaleVehicle saleVehicle) {
<span class="nc bnc" id="L28" title="All 2 branches missed.">        if (ContractValidator.isValidPurchaseContract(contractId, customer, saleVehicle)) {</span>
<span class="nc" id="L29">            Contract contract = new Contract(contractId, customer, saleVehicle, null, false,</span>
<span class="nc" id="L30">                    LocalDate.now(), null, null);</span>
<span class="nc" id="L31">            contracts.add(contract);</span>
<span class="nc" id="L32">            return true;</span>
        }
<span class="nc" id="L34">        return false;</span>
    }

    /**
     * Creates a rental contract.
     *
     * @param contractId       The unique ID of the contract.
     * @param customer         The customer associated with the contract.
     * @param rentVehicle      The vehicle involved in the rental contract.
     * @param rentalStartDate  The start date of the rental period.
     * @param rentalEndDate    The end date of the rental period.
     * @return True if the rental contract is successfully created, false otherwise.
     */
    public static boolean createRentalContract(int contractId, Customer customer, RentVehicle rentVehicle,
                                               LocalDate rentalStartDate, LocalDate rentalEndDate) {
<span class="nc bnc" id="L49" title="All 2 branches missed.">        if (ContractValidator.isValidRentalContract(contractId, customer, rentVehicle, rentalStartDate, rentalEndDate)) {</span>
<span class="nc" id="L50">            Contract contract = new Contract(contractId, customer, null, rentVehicle, true,</span>
<span class="nc" id="L51">                    LocalDate.now(), rentalStartDate, rentalEndDate);</span>
<span class="nc" id="L52">            contracts.add(contract);</span>
<span class="nc" id="L53">            return true;</span>
        }
<span class="nc" id="L55">        return false;</span>
    }

    /**
     * Terminates a rental contract.
     *
     * @param contractId The unique ID of the contract.
     * @return True if the rental contract is successfully terminated, false otherwise.
     */
    public static boolean terminateRentalContract(int contractId) {
<span class="nc" id="L65">        Contract contract = getContractById(contractId);</span>
<span class="nc bnc" id="L66" title="All 4 branches missed.">        if (contract != null &amp;&amp; contract.isRentalContract()) {</span>
<span class="nc" id="L67">            contract.setRentalEndDate(LocalDate.now());</span>
<span class="nc" id="L68">            contract.getRentVehicle().setAvailable(true);</span>
<span class="nc" id="L69">            return true;</span>
        }
<span class="nc" id="L71">        return false;</span>
    }

    /**
     * Renews a rental contract.
     *
     * @param contractId         The unique ID of the contract.
     * @param newRentalEndDate   The new end date of the rental period.
     * @return True if the rental contract is successfully renewed, false otherwise.
     */
    public static boolean renewRentalContract(int contractId, LocalDate newRentalEndDate) {
<span class="nc" id="L82">        Contract contract = getContractById(contractId);</span>
<span class="nc bnc" id="L83" title="All 6 branches missed.">        if (contract != null &amp;&amp; contract.isRentalContract() &amp;&amp; validateRentalPeriod(contract.getRentalStartDate(), newRentalEndDate)) {</span>
<span class="nc" id="L84">            contract.setRentalEndDate(newRentalEndDate);</span>
<span class="nc" id="L85">            contract.getRentVehicle().setAvailable(false);</span>
<span class="nc" id="L86">            return true;</span>
        }
<span class="nc" id="L88">        return false;</span>
    }

    /**
     * Retrieves the total price of a rental contract.
     *
     * @param contractId The unique ID of the contract.
     * @return The total price of the rental contract, or -1 if the contract is not found or is not a rental contract.
     */
    public static BigDecimal getTotalPrice(int contractId) {
<span class="nc" id="L98">        Contract contract = getContractById(contractId);</span>
<span class="nc bnc" id="L99" title="All 4 branches missed.">        if (contract != null &amp;&amp; contract.isRentalContract()) {</span>
<span class="nc" id="L100">            long daysRented = ChronoUnit.DAYS.between(contract.getRentalStartDate(), contract.getRentalEndDate());</span>
<span class="nc" id="L101">            return BigDecimal.valueOf(daysRented).multiply(contract.getRentVehicle().getDailyPrice());</span>
        }
<span class="nc" id="L103">        return BigDecimal.valueOf(-1);</span>
    }

    /**
     * Retrieves the details of a rental contract.
     *
     * @param contractId The unique ID of the contract.
     * @return A string containing the details of the rental contract if found, or a message indicating that the contract was not found.
     */
    public static String getRentalContractDetails(int contractId) {
<span class="nc" id="L113">        Contract contract = getContractById(contractId);</span>
<span class="nc bnc" id="L114" title="All 4 branches missed.">        if (contract != null &amp;&amp; contract.isRentalContract()) {</span>
<span class="nc" id="L115">            return &quot;Rental Contract Details:\n&quot; +</span>
                    &quot;Contract ID: &quot; + contractId + &quot;\n&quot; +
<span class="nc" id="L117">                    &quot;Customer: &quot; + contract.getCustomer().getDetails() + &quot;\n&quot; +</span>
<span class="nc" id="L118">                    &quot;Rent Vehicle: &quot; + contract.getRentVehicle().getDetails() + &quot;\n&quot; +</span>
<span class="nc" id="L119">                    &quot;Rental Start Date: &quot; + contract.getRentalStartDate() + &quot;\n&quot; +</span>
<span class="nc" id="L120">                    &quot;Rental End Date: &quot; + contract.getRentalEndDate();</span>
        }
<span class="nc" id="L122">        return &quot;No rental contract found with this ID.&quot;;</span>
    }

    /**
     * Retrieves the details of a purchase contract.
     *
     * @param contractId The unique ID of the contract.
     * @return A string containing the details of the purchase contract if found, or a message indicating that the contract was not found.
     */
    public static String getPurchaseContractDetails(int contractId) {
<span class="nc" id="L132">        Contract contract = getContractById(contractId);</span>
<span class="nc bnc" id="L133" title="All 4 branches missed.">        if (contract != null &amp;&amp; !contract.isRentalContract()) {</span>
<span class="nc" id="L134">            return &quot;Purchase Contract Details:\n&quot; +</span>
                    &quot;Contract ID: &quot; + contractId + &quot;\n&quot; +
<span class="nc" id="L136">                    &quot;Customer: &quot; + contract.getCustomer().getDetails() + &quot;\n&quot; +</span>
<span class="nc" id="L137">                    &quot;Sale Vehicle: &quot; + contract.getSaleVehicle().getDetails();</span>
        }
<span class="nc" id="L139">        return &quot;No purchase contract found with this ID.&quot;;</span>
    }

    public static boolean contractExists(int contractId) {
<span class="nc bnc" id="L143" title="All 2 branches missed.">        return contracts.stream().anyMatch(contract -&gt; contract.getContractId() == contractId);</span>
    }

    public static Contract getContractById(int contractId) {
<span class="nc bnc" id="L147" title="All 2 branches missed.">        return contracts.stream().filter(contract -&gt; contract.getContractId() == contractId).findFirst().orElse(null);</span>
    }

    public static boolean validateRentalPeriod(LocalDate startDate, LocalDate endDate) {
<span class="nc bnc" id="L151" title="All 8 branches missed.">        return startDate != null &amp;&amp; endDate != null &amp;&amp; !startDate.isAfter(endDate) &amp;&amp; !startDate.isBefore(LocalDate.now());</span>
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>